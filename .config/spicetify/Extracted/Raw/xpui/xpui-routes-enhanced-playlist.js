"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[682],{45685:(e,n,t)=>{t.r(n),t.d(n,{EnhancedPlaylist:()=>ye,default:()=>ge});var r=t(59713),a=t.n(r),i=t(63038),l=t.n(i),c=(t(68309),t(47941),t(82526),t(57327),t(41539),t(38880),t(89554),t(54747),t(49337),t(33321),t(69070),t(67294)),o=t.n(c),u=t(48556),s=t(95661),d=t(13020),m=t(70369),f=t(55120),v=t(83979),p=t(20657),b=t(30947),y=t(55911),g=t(20246),h=t(43620),E=t(84242),x=t(1496),k=t(6479),I=t.n(k),P=t(48926),R=t.n(P),w=t(87757),O=t.n(w),C=(t(91038),t(78783),t(26541),t(92222),t(9653),t(69518)),T=t.n(C),j=t(44794),U=t(94967),N=t(8247),F=t(11680),_=t(45287),D=["pageItems"];function S(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function B(e,n,t,r){var i=r?{}:function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?S(Object(t),!0).forEach((function(n){a()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},e);return n.forEach((function(e,n){i[t+n]=e})),i}var M=t(32567),A=(t(21249),t(35308)),L=t(28248),z=t(73785),Z=t(4236),X=t(42922),q=t(7073),G=t(49961),K=(t(69600),t(44461)),Q=t(9296),$=t(52284),V=t(86213),W=t(27481),H=t(83384),J=t(82760),Y=t(32626),ee=t(65095),ne=t(87257),te=t(57978),re=t(75016),ae=t(24656),ie=t(84788),le=t(94184),ce=t.n(le),oe=t(83692);const ue="TRDgmejiOzKjissuLFSx";var se=function(e){var n=e.onClick,t=void 0===n?function(){}:n,r=e.className,a=e.label,i=e.ariaLabel,l=void 0===i?a:i,c=e.Icon;return o().createElement(oe.w,{label:a},o().createElement("button",{type:"button","aria-label":l,className:ce()(ue,r),onClick:t},o().createElement(c,{iconSize:16})))},de=o().memo((function(e){var n,t=e.uri,r=e.uid,a=e.name,i=e.durationMs,u=e.artists,s=e.album,d=e.isMOGEFRestricted,m=e.isExplicit,f=e.isPlayable,v=e.index,b=e.playIndex,y=void 0===b?null:b,g=e.imgUrl,h=e.contextUri,E=e.usePlayContextItem,x=e.isEnhanced,k=e.add,I=e.remove,P=e.canBeRemovedFromPlaylist,R=(0,(0,c.useContext)(ae.I).useCurrentAvailability)(t),w=l()(R,2),O=w[0],C=w[1],T=f&&O,j=(0,ie.r)({offlineAvailability:C,isExplicit:m,isMOGEFRestricted:d,isEnhanced:x}),U=j.badges,N=j.hasBadges,F=v+1,_=u.items.map((function(e){return{uri:e.uri,name:e.profile.name}})),D=o().createElement(V.$,{uri:t,uid:r,albumUri:null==s?void 0:s.uri,artists:_,contextUri:h,isRecommendation:x,removePlaylistItems:function(){return I(r)},removeRecommendation:function(){return I(r)},addRecommendation:function(){return k(r)},canBeRemovedFromPlaylist:P}),S=(null==_?void 0:_.map((function(e){return e.name})).join(p.ag.getSeparator()))||"",B=E({uid:r,uri:t,index:null!=y?y:v}),M=B.isActive,A=B.isPlaying,L=B.triggerPlay,z=B.togglePlay;return o().createElement(X.ZP,{value:"row",index:v},o().createElement(Y._P,{menu:D},o().createElement(J.c,{uri:t,contextUri:h,index:v,onTriggerPlay:function(){L()},isActive:M,ariaRowIndex:v+1,isPlayable:T,ageRestricted:d,dragMetadata:{name:a,createdBy:S}},o().createElement(W.Dd,{ariaColIndex:0},o().createElement(W.Du,{uri:t,playAriaLabel:p.ag.get("tracklist.a11y.play",a,S),onClick:function(){z()},isPlaying:A,isActive:M},o().createElement(W.km,null,F))),o().createElement(W.vZ,{ariaColIndex:1},o().createElement(W.lD,{src:g}),o().createElement(W.vm,null,o().createElement(W.Wh,{titleText:a},a),N&&o().createElement(W.g3,null,U.enhanced&&o().createElement(K.J,{iconSize:16,className:H.Z.enhanced,"aria-label":p.ag.get("web-player.enhance.button_text_enhanced")}),U.download&&o().createElement(ee.G,{size:16}),U.explicit&&o().createElement(ne.N,null),U.paid&&o().createElement(re.g,null),U.nineteen&&o().createElement(te.X,{className:H.Z.nineteen,size:16})),o().createElement(W.K9,null,o().createElement(W.T6,{artists:_})))),o().createElement(W.UA,{ariaColIndex:2},o().createElement(W.BM,{uri:s.uri,name:s.name,creatorUri:null==_||null===(n=_[0])||void 0===n?void 0:n.uri},s.name)),o().createElement(W.mU,{ariaColIndex:3},!!x&&o().createElement(o().Fragment,null,o().createElement(se,{onClick:function(){return k(r)},label:p.ag.get("web-player.enhance.button_label_keep_in_playlist"),Icon:Q.Z}),o().createElement(se,{onClick:function(){return I(r)},label:p.ag.get("web-player.enhance.button_label_remove_from_playlist"),Icon:$.w})),o().createElement(W.A$,{duration:i}),o().createElement(W.Zv,{menu:D,label:p.ag.get("more.label.track",a,S)})))))})),me=[z.Q.INDEX,z.Q.TITLE,z.Q.ALBUM,z.Q.DURATION],fe=o().memo((function(e){var n=e.ariaLabel,t=e.uri,r=e.name,a=e.usePlayContextItem,i=e.tracklistRef,u=e.fetchTracks,s=e.addRecommendation,d=e.removeRecommendation,m=e.nrTracks,f=e.canBeRemovedFromPlaylist,v=(0,c.useRef)(!1),b=(0,Z.k)();(0,c.useEffect)((function(){var e;v.current&&b&&(null==i||null===(e=i.current)||void 0===e||e.update());v.current=!0}),[b,i]);var y=(0,c.useRef)((function(){})),g=(0,c.useState)([]),h=l()(g,2),E=h[0],x=h[1],k=(0,c.useCallback)((function(){var e,n=null==i||null===(e=i.current)||void 0===e?void 0:e.getVisibleTrackWindow(),t=n.firstIndex,r=n.lastIndex-t;return Math.max(0,t-Math.round((50-r)/2))}),[i]),I=(0,c.useCallback)((function(e){y.current(),d({itemIds:e.map((function(e){return e.id})),offset:k(),limit:50})}),[d,k]),P=(0,c.useCallback)((function(e,n){y.current=n,e.length>1?x(e):I(e)}),[I]),R=(0,c.useCallback)((function(e){s({itemIds:[e],offset:k(),limit:50})}),[s,k]),w=(0,c.useCallback)((function(e){d({itemIds:[e],offset:k(),limit:50})}),[d,k]),O=(0,c.useCallback)((function(e,n){var r,i,l,c=(0,G.X)(null===(r=e.album.coverArt)||void 0===r?void 0:r.sources,{desiredSize:40,desiredLabel:"small"});return o().createElement(de,{key:e.uid,index:n,playIndex:n,contextUri:t,uri:e.uri,uid:e.uid,isPlayable:e.playability.playable,durationMs:e.duration.totalMilliseconds,name:e.name,artists:e.artists,album:e.album,isExplicit:(null===(i=e.contentRating)||void 0===i?void 0:i.label)===q.KS.Explicit,isMOGEFRestricted:(null===(l=e.contentRating)||void 0===l?void 0:l.label)===q.KS.NineteenPlus,imgUrl:(null==c?void 0:c.url)||"",usePlayContextItem:a,isEnhanced:e.isEnhanced,add:R,remove:w,canBeRemovedFromPlaylist:f})}),[a,t,R,w,f]),C=(0,c.useCallback)((function(e){return e.uri}),[]),T=(0,c.useCallback)((function(e){return e.uid}),[]);return o().createElement(o().Fragment,null,o().createElement(X.ZP,{value:"playlist-tracklist"},o().createElement(L.Pv,{testID:"playlist-tracklist",key:t,ariaLabel:n,hasHeaderRow:!0,columns:me,onRemove:P,renderRow:O,resolveUri:C,resolveUid:T,nrTracks:m,fetchTracks:u,limit:50,outerRef:i})),o().createElement(A.h,{title:p.ag.get("playlist.remove_from_playlist",r),isOpen:E.length>0,tracks:E,onClose:function(e){e.stopPropagation(),x([])},onRemove:I}))}));const ve={xs:"(min-width: 0px)",xsOnly:"(min-width: 0px) and (max-width: 767px)",sm:"(min-width: 768px)",smOnly:"(min-width: 768px) and (max-width: 1023px)",md:"(min-width: 1024px)",mdOnly:"(min-width: 1024px) and (max-width: 1279px)",lg:"(min-width: 1280px)",lgOnly:"(min-width: 1280px) and (max-width: 1919px)",xl:"(min-width: 1920px)",enhancedPlaylist:"OfFtIpc_qctF95n1Xk6p",playlistImageContainer:"q91bEN94vb8qNievR8JN"};function pe(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function be(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?pe(Object(t),!0).forEach((function(n){a()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):pe(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var ye=o().memo((function(e){var n=e.metadata,t=n.uri,r=n.name,a=n.images,i=n.totalLength,k=n.canPlay,P=n.canRemove,w=l()(a,1)[0],C=(0,h.Z)((null==w?void 0:w.url)||null),S=(0,c.useRef)(null),A=function(e){var n,t=(0,F._)(),r=(0,_.U)(e),a=r.isEnhanced,i=r.iteration,o=r.setIsEnhanced,u=r.toggleIsEnhanced,s=(0,j.W6)(N.HT),d=e;if(T().isPlaylistV1OrV2(e)){var m=T().from(e).getBase62Id();d=s?"spotify:enhanced:playlist:".concat(m):"spotify:dynamic-playlist-session:".concat(m)}else s&&T().isCollection(e)&&(d="spotify:enhanced:collection:tracks");var f=(0,c.useState)(null),v=l()(f,2),p=v[0],b=v[1],y=(0,c.useRef)({}),g=(0,c.useRef)(null),h=(0,c.useCallback)(function(){var e=R()(O().mark((function e(n,r,a,i,l,c,o){var u,s,d,m,f,v,p,h,E,x;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f=null===(u=g.current)||void 0===u?void 0:u.enhancedRevision,e.prev=1,e.next=4,o;case 4:v=e.sent,e.next=13;break;case 7:if(e.prev=7,e.t0=e.catch(1),409!==(null===e.t0||void 0===e.t0?void 0:e.t0.status)){e.next=13;break}return e.next=12,t.getPage(n,r,a,i,l);case 12:v=e.sent;case 13:if(p=null===(s=v)||void 0===s?void 0:s.enhancePage){e.next=16;break}return e.abrupt("return",[]);case 16:return h=p.pageItems,E=I()(p,D),e.next=19,t.decoratePageItems(h);case 19:if(x=e.sent,f===(null===(d=g.current)||void 0===d?void 0:d.enhancedRevision)){e.next=23;break}return e.abrupt("return",[]);case 23:return(null===(m=g.current)||void 0===m?void 0:m.enhancedRevision)!==E.enhancedRevision&&(c=!0),y.current=B(y.current,x,i,c),b(E),g.current=E,e.abrupt("return",x);case 29:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(n,t,r,a,i,l,c){return e.apply(this,arguments)}}(),[t]),E=(0,c.useCallback)(function(){var n=R()(O().mark((function n(r){var a,l,c,o,u;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=r.itemIds,l=r.offset,c=void 0===l?0:l,o=r.limit,u=void 0===o?1:o,g.current&&i){n.next=3;break}return n.abrupt("return");case 3:h(e,i,g.current.sessionId,c,u,!0,t.addRecommendation(e,g.current.sessionId,g.current.contextRevision,a,c,u));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),[h,e,t,i]),x=(0,c.useCallback)(function(){var n=R()(O().mark((function n(r){var a,l,c,o,u;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=r.itemIds,l=r.offset,c=void 0===l?0:l,o=r.limit,u=void 0===o?1:o,g.current&&i){n.next=3;break}return n.abrupt("return");case 3:h(e,i,g.current.sessionId,c,u,!0,t.removeRecommendation(e,g.current.sessionId,g.current.contextRevision,a,c,u));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),[h,e,t,i]),k=(0,c.useMemo)((function(){return new U.tL}),[]),P=(0,c.useCallback)(function(){var n=R()(O().mark((function n(r,a){var l,c,o,u,s;return O().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i){n.next=2;break}return n.abrupt("return",[]);case 2:if(u=Math.min(a,((null===(l=g.current)||void 0===l?void 0:l.numTotalItems)||1/0)-r),!(s=Array.from({length:u},(function(e,n){return y.current[n+r]}))).every((function(e){return!!e}))){n.next=7;break}return n.abrupt("return",s);case 7:return n.abrupt("return",h(e,i,null===(c=g.current)||void 0===c?void 0:c.sessionId,r,a,!1,k.create("".concat(e,":").concat(i,":").concat(null===(o=g.current)||void 0===o?void 0:o.sessionId,":").concat(r,":").concat(a),(function(){var n;return t.getPage(e,i,null===(n=g.current)||void 0===n?void 0:n.sessionId,r,a)}))));case 8:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),[k,h,e,t,i]);return{isEnhanced:a,setIsEnhanced:o,toggleIsEnhanced:u,addRecommendation:E,removeRecommendation:x,playContext:(0,c.useMemo)((function(){return{uri:d,url:null==p?void 0:p.dspContextUri}}),[d,null==p?void 0:p.dspContextUri]),numTotalItems:isNaN(Number(null==p?void 0:p.numTotalItems))?void 0:Number(null==p?void 0:p.numTotalItems),numTotalRecs:isNaN(Number(null==p?void 0:p.numTotalRecs))?void 0:Number(null==p?void 0:p.numTotalRecs),fetchTracks:P,enhancedRevision:null==p?void 0:p.enhancedRevision,UBIReason:p?"".concat(null==p?void 0:p.sessionId,"#").concat(null==p||null===(n=p.logging)||void 0===n?void 0:n.correlationId):""}}(t),L=A.playContext,z=A.numTotalItems,Z=A.addRecommendation,X=A.removeRecommendation,q=A.fetchTracks,G=A.enhancedRevision,K=A.UBIReason;(0,c.useEffect)((function(){var e;G&&(null===(e=S.current)||void 0===e||e.update())}),[G]);var Q=(0,E.n)(L,{featureIdentifier:"playlist"}),$=Q.isPlaying,V=Q.togglePlay,W=Q.usePlayContextItem,H=(0,c.useCallback)((function(){return V()}),[V]),J=(0,x.fU)(u.createDesktopEnhancedEventFactory,{data:{uri:t,identifier:"enhanced-session",reason:K}}),Y=J.spec,ee=J.logger,ne=J.UBIFragment,te=(0,c.useCallback)((function(){var e=Y.headerFactory().enhanceButtonFactory().hitUnenhanceContext({contextToBeUnenhanced:t});ee.logInteraction(e)}),[ee,Y,t]);return o().createElement(c.Suspense,{fallback:null},o().createElement(ne,{spec:Y},o().createElement(m.$,null,p.ag.get("playlist.page-title",r)),o().createElement("section",{role:"presentation",className:ve.enhancedPlaylist,"data-testid":"enhanced-playlist-page"},o().createElement(v.s,{metadata:be(be({},n),{},{duration:null,totalLength:null!=z?z:i}),isPlaying:$,togglePlay:H,backgroundColor:C}),o().createElement("div",{className:ve.playlistContent},o().createElement(b.o,{backgroundColor:C},o().createElement(b.F,null,k?o().createElement(f.$,{onClick:H,isPlaying:$,size:y.qE.lg,uri:t}):null,o().createElement(M.v,{uri:t,onClick:te}),o().createElement(g.y,{menu:o().createElement(d.X,{uri:t})},o().createElement(s.z,null))))),o().createElement("div",{className:"contentSpacing"},o().createElement(c.Suspense,{fallback:null},o().createElement(fe,{key:t,ariaLabel:r,nrTracks:null!=z?z:Math.max(15,i),uri:t,name:r,usePlayContextItem:W,tracklistRef:S,fetchTracks:q,addRecommendation:Z,removeRecommendation:X,canBeRemovedFromPlaylist:P}))))))}));const ge=ye}}]);
//# sourceMappingURL=xpui-routes-enhanced-playlist.js.map