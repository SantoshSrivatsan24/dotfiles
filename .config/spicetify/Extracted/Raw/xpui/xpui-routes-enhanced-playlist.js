"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[682],{45685:(e,t,n)=>{n.r(t),n.d(t,{EnhancedPlaylist:()=>pe,default:()=>ye});var a=n(59713),l=n.n(a),r=n(67294),i=n.n(r),c=n(95661),o=n(13020),s=n(70369),u=n(55120),m=n(83979),d=n(20657),p=n(30947),y=n(55911),b=n(20246),v=n(43620),f=n(84242),g=n(6479),E=n.n(g),h=n(69518),x=n.n(h),k=n(44794),P=n(47991),R=n(56705),w=n(80624),I=n(19719),O=n(94967),C=n(8247),j=n(11680),T=n(45287);const N=["pageItems"];function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function M(e){const t=(0,j._)(),{isEnhanced:n,iteration:a,setIsEnhanced:l,toggleIsEnhanced:i}=(0,T.U)(e),c=(0,k.W6)(C.HT);let o=e;if(x().isPlaylistV1OrV2(e)){const t=x().from(e).getBase62Id();o=c?`spotify:enhanced:playlist:${t}`:`spotify:dynamic-playlist-session:${t}`}else c&&x().isCollection(e)&&(o="spotify:enhanced:collection:tracks");const[s,u]=(0,r.useState)(null),m=(0,r.useRef)({}),d=(0,r.useRef)(null),p=(0,r.useMemo)((()=>new O.Ct),[]),y=(0,r.useMemo)((()=>new O.tL),[]),b=(0,r.useCallback)((async e=>{const t=Array.from(new Set(e.map((e=>e.uri)))).filter((e=>!p.has(e)));return(await(0,R.s)(t,(async e=>{const t=e.map((e=>x().from(e).getBase62Id())),{body:n}=await y.create(t.join(","),(()=>I.fQ.getTracks(w.b.getInstance(),t)));return n.tracks}))).flat().forEach((e=>p.set((0,P.$V)(e),e))),n=p,e.map((e=>{var t;return U(U({},n.get(e.uri)),{},{uid:null==e?void 0:e.itemId,isEnhanced:null==e||null===(t=e.itemAttributes)||void 0===t?void 0:t.isRecommendation})}));var n}),[p,y]),v=(0,r.useCallback)((async(e,n,a,l,r,i)=>{var c,o,s,p;const y=null===(c=d.current)||void 0===c?void 0:c.enhancedRevision;let v;try{v=await i}catch(r){409===(null==r?void 0:r.status)&&(v=await t.getPage(e,n,a,l))}const f=null===(o=v)||void 0===o?void 0:o.enhancePage;if(!f)return[];const{pageItems:g}=f,h=E()(f,N),x=await b(g);if(y!==(null===(s=d.current)||void 0===s?void 0:s.enhancedRevision))return[];return(null===(p=d.current)||void 0===p?void 0:p.enhancedRevision)!==h.enhancedRevision&&(r=!0),m.current=function(e,t,n,a){const l=a?{}:U({},e);return t.forEach(((e,t)=>{l[n+t]=e})),l}(m.current,x,a,r),u(h),d.current=h,x}),[b,t]),f=(0,r.useCallback)((async({itemIds:n,offset:l=0,limit:r=1})=>{d.current&&a&&v(e,a,l,r,!0,t.addRecommendation(e,d.current.sessionId,d.current.contextRevision,n,l,r))}),[v,e,t,a]),g=(0,r.useCallback)((async({itemIds:n,offset:l=0,limit:r=1})=>{d.current&&a&&v(e,a,l,r,!0,t.removeRecommendation(e,d.current.sessionId,d.current.contextRevision,n,l,r))}),[v,e,t,a]),h=(0,r.useMemo)((()=>new O.tL),[]),_=(0,r.useCallback)((async(n,l)=>{var r;if(!a)return[];const i=Math.min(l,((null===(r=d.current)||void 0===r?void 0:r.numTotalItems)||1/0)-n),c=Array.from({length:i},((e,t)=>m.current[t+n]));return c.every((e=>!!e))?c:v(e,a,n,l,!1,h.create(`${e}:${a}:${n}:${l}`,(()=>t.getPage(e,a,n,l))))}),[h,v,e,t,a]);return{isEnhanced:n,setIsEnhanced:l,toggleIsEnhanced:i,addRecommendation:f,removeRecommendation:g,playContext:(0,r.useMemo)((()=>({uri:o,url:null==s?void 0:s.dspContextUri})),[o,null==s?void 0:s.dspContextUri]),numTotalItems:isNaN(Number(null==s?void 0:s.numTotalItems))?void 0:Number(null==s?void 0:s.numTotalItems),numTotalRecs:isNaN(Number(null==s?void 0:s.numTotalRecs))?void 0:Number(null==s?void 0:s.numTotalRecs),fetchTracks:_,enhancedRevision:null==s?void 0:s.enhancedRevision}}var D=n(32567),S=n(35308),F=n(28248),A=n(73785),L=n(4236),B=n(42922),$=n(49961),z=n(44461),Z=n(9296),Q=n(52284),X=n(86213),q=n(27481),G=n(83384),V=n(82760),W=n(32626),H=n(65095),J=n(87257),K=n(57978),Y=n(75016),ee=n(24656),te=n(84788),ne=n(94184),ae=n.n(ne),le=n(83692);const re="TRDgmejiOzKjissuLFSx",ie=({onClick:e=(()=>{}),className:t,label:n,ariaLabel:a=n,Icon:l})=>i().createElement(le.w,{label:n},i().createElement("button",{type:"button","aria-label":a,className:ae()(re,t),onClick:e},i().createElement(l,{iconSize:16}))),ce=i().memo((function({uri:e,uid:t,name:n,durationMs:a,artists:l,album:c,isMOGEFRestricted:o,isExplicit:s,isPlayable:u,index:m,playIndex:p=null,imgUrl:y,contextUri:b,usePlayContextItem:v,isEnhanced:f,add:g,remove:E,canBeRemovedFromPlaylist:h}){var x;const{useCurrentAvailability:k}=(0,r.useContext)(ee.I),[P,R]=k(e),w=u&&P,{badges:I,hasBadges:O}=(0,te.r)({offlineAvailability:R,isExplicit:s,isMOGEFRestricted:o,isEnhanced:f}),C=m+1,j=i().createElement(X.$,{uri:e,uid:t,albumUri:null==c?void 0:c.uri,artists:l,contextUri:b,isRecommendation:f,removePlaylistItems:()=>E(t),removeRecommendation:()=>E(t),addRecommendation:()=>g(t),canBeRemovedFromPlaylist:h}),T=(null==l?void 0:l.map((e=>e.name)).join(d.ag.getSeparator()))||"",{isActive:N,isPlaying:_,triggerPlay:U,togglePlay:M}=v({uid:t,uri:e,index:null!=p?p:m});return i().createElement(B.ZP,{value:"row",index:m},i().createElement(W._P,{menu:j},i().createElement(V.c,{uri:e,contextUri:b,index:m,onTriggerPlay:()=>{U()},isActive:N,ariaRowIndex:m+1,isPlayable:w,ageRestricted:o,dragMetadata:{name:n,createdBy:T}},i().createElement(q.Dd,{ariaColIndex:0},i().createElement(q.Du,{uri:e,playAriaLabel:d.ag.get("tracklist.a11y.play",n,T),onClick:()=>{M()},isPlaying:_,isActive:N},i().createElement(q.km,null,C))),i().createElement(q.vZ,{ariaColIndex:1},i().createElement(q.lD,{src:y}),i().createElement(q.vm,null,i().createElement(q.Wh,{titleText:n},n),O&&i().createElement(q.g3,null,I.enhanced&&i().createElement(z.J,{iconSize:16,className:G.Z.enhanced,"aria-label":d.ag.get("web-player.enhance.button_text_enhanced")}),I.download&&i().createElement(H.G,{size:16}),I.explicit&&i().createElement(J.N,null),I.paid&&i().createElement(Y.g,null),I.nineteen&&i().createElement(K.X,{className:G.Z.nineteen,size:16})),i().createElement(q.K9,null,i().createElement(q.T6,{artists:l})))),i().createElement(q.UA,{ariaColIndex:2},i().createElement(q.BM,{uri:c.uri,name:c.name,creatorUri:null==l||null===(x=l[0])||void 0===x?void 0:x.uri},c.name)),i().createElement(q.mU,{ariaColIndex:3},!!f&&i().createElement(i().Fragment,null,i().createElement(ie,{onClick:()=>g(t),label:d.ag.get("web-player.enhance.button_label_keep_in_playlist"),Icon:Z.Z}),i().createElement(ie,{onClick:()=>E(t),label:d.ag.get("web-player.enhance.button_label_remove_from_playlist"),Icon:Q.w})),i().createElement(q.A$,{duration:a}),i().createElement(q.Zv,{menu:j,label:d.ag.get("more.label.track",n,T)})))))})),oe=[A.Q.INDEX,A.Q.TITLE,A.Q.ALBUM,A.Q.DURATION],se=i().memo((function({ariaLabel:e,uri:t,name:n,usePlayContextItem:a,tracklistRef:l,fetchTracks:c,addRecommendation:o,removeRecommendation:s,nrTracks:u,canBeRemovedFromPlaylist:m}){const p=(0,r.useRef)(!1),y=(0,L.k)();(0,r.useEffect)((()=>{var e;p.current&&y&&(null==l||null===(e=l.current)||void 0===e||e.update());p.current=!0}),[y,l]);const b=(0,r.useRef)((()=>{})),[v,f]=(0,r.useState)([]),g=(0,r.useCallback)((()=>{var e;const{firstIndex:t,lastIndex:n}=null==l||null===(e=l.current)||void 0===e?void 0:e.getVisibleTrackWindow(),a=n-t;return Math.max(0,t-Math.round((50-a)/2))}),[l]),E=(0,r.useCallback)((e=>{b.current(),s({itemIds:e.map((({id:e})=>e)),offset:g(),limit:50})}),[s,g]),h=(0,r.useCallback)(((e,t)=>{b.current=t,e.length>1?f(e):E(e)}),[E]),x=(0,r.useCallback)((e=>{o({itemIds:[e],offset:g(),limit:50})}),[o,g]),k=(0,r.useCallback)((e=>{s({itemIds:[e],offset:g(),limit:50})}),[s,g]),P=(0,r.useCallback)((function(e,n){const l=(0,$.X)(e.album.images,{desiredSize:40,desiredLabel:"small"});return i().createElement(ce,{key:e.uid,index:n,playIndex:n,contextUri:t,uri:e.uri,uid:e.uid,isPlayable:e.is_playable,durationMs:e.duration_ms,name:e.name,artists:e.artists,album:e.album,isExplicit:e.explicit,isMOGEFRestricted:!!e.mogef19,imgUrl:(null==l?void 0:l.url)||"",usePlayContextItem:a,isEnhanced:e.isEnhanced,add:x,remove:k,canBeRemovedFromPlaylist:m})}),[a,t,x,k,m]),R=(0,r.useCallback)((e=>e.uri),[]),w=(0,r.useCallback)((e=>e.uid),[]);return i().createElement(i().Fragment,null,i().createElement(B.ZP,{value:"playlist-tracklist"},i().createElement(F.Pv,{testID:"playlist-tracklist",key:t,ariaLabel:e,hasHeaderRow:!0,columns:oe,onRemove:h,renderRow:P,resolveUri:R,resolveUid:w,nrTracks:u,fetchTracks:c,limit:50,outerRef:l})),i().createElement(S.h,{title:d.ag.get("playlist.remove_from_playlist",n),isOpen:v.length>0,tracks:v,onClose:e=>{e.stopPropagation(),f([])},onRemove:E}))})),ue={xs:"(min-width: 0px)",xsOnly:"(min-width: 0px) and (max-width: 767px)",sm:"(min-width: 768px)",smOnly:"(min-width: 768px) and (max-width: 1023px)",md:"(min-width: 1024px)",mdOnly:"(min-width: 1024px) and (max-width: 1279px)",lg:"(min-width: 1280px)",lgOnly:"(min-width: 1280px) and (max-width: 1919px)",xl:"(min-width: 1920px)",enhancedPlaylist:"OfFtIpc_qctF95n1Xk6p",playlistImageContainer:"q91bEN94vb8qNievR8JN"};function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const pe=i().memo((function({metadata:e}){const{uri:t,name:n,images:a,totalLength:l,canPlay:g,canRemove:E}=e,[h]=a,x=(0,v.Z)((null==h?void 0:h.url)||null),k=(0,r.useRef)(null),{playContext:P,numTotalItems:R,addRecommendation:w,removeRecommendation:I,fetchTracks:O,enhancedRevision:C}=M(t);(0,r.useEffect)((()=>{var e;C&&(null===(e=k.current)||void 0===e||e.update())}),[C]);const{isPlaying:j,togglePlay:T,usePlayContextItem:N}=(0,f.n)(P,{featureIdentifier:"playlist"}),_=(0,r.useCallback)((()=>T()),[T]);return i().createElement(r.Suspense,{fallback:null},i().createElement(s.$,null,d.ag.get("playlist.page-title",n)),i().createElement("section",{role:"presentation",className:ue.enhancedPlaylist,"data-testid":"enhanced-playlist-page"},i().createElement(m.s,{metadata:de(de({},e),{},{duration:null,totalLength:null!=R?R:l}),isPlaying:j,togglePlay:_,backgroundColor:x}),i().createElement("div",{className:ue.playlistContent},i().createElement(p.o,{backgroundColor:x},i().createElement(p.F,null,g?i().createElement(u.$,{onClick:_,isPlaying:j,size:y.qE.lg,uri:t}):null,i().createElement(D.v,{uri:t}),i().createElement(b.y,{menu:i().createElement(o.X,{uri:t})},i().createElement(c.z,null))))),i().createElement("div",{className:"contentSpacing"},i().createElement(r.Suspense,{fallback:null},i().createElement(se,{key:t,ariaLabel:n,nrTracks:null!=R?R:Math.max(15,l),uri:t,name:n,usePlayContextItem:N,tracklistRef:k,fetchTracks:O,addRecommendation:w,removeRecommendation:I,canBeRemovedFromPlaylist:E})))))})),ye=pe}}]);
//# sourceMappingURL=xpui-routes-enhanced-playlist.js.map